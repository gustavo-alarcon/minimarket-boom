<div class="w3-section w3-hide-large w3-hide-medium">
    <div class="w3-padding formFieldRounded" *ngIf="(dbs.view$|async)==1">
        <mat-form-field appearance="outline" class="w3-block">
            <mat-label>Buscar</mat-label>
            <input matInput [formControl]="searchForm" placeholder="Buscar Producto" autocomplete="off">
            <mat-icon matPrefix style="vertical-align: middle;margin-right: 5px;">search</mat-icon>
        </mat-form-field>

        <div *ngIf="products$ | async as products">
            <mat-card class="product w3-margin-bottom" *ngFor="let product of products| paginate: { itemsPerPage: 10, currentPage: p }">
                <div class="ms-flex product__container">
                    <div class="product__image-div">
                        <img [defaultImage]="defaultImage" [lazyLoad]="product.photoURL" [offset]="100"
                            class="product__image">
                    </div>
                    <div class="product__descrip">
                        <div class="ms-flex product__container">
                            <div class="product__title">{{product.description | titlecase}}</div>
                            <button mat-icon-button color='accent' [routerLink]="['recetas', product.id]">
                                <mat-icon>local_dining</mat-icon>
                            </button>
                        </div>
                        <div *ngIf="product.realStock <= product.sellMinimum" class="product__provision">En
                            abastecimiento</div>
                        <p class="product__paragraph">{{product.additionalDescription}}</p>
                        <div class="ms-flex product__container">
                            <div>
                                <div class="product__etiquet">Precio por {{product.unit}}</div>
                                <div class="ms-flex" style="align-items: flex-end;">
                                    <div *ngIf="!product.promo || product.promoData.quantity > 1"
                                        class="product__price">
                                        <span style="font-size: 0.65em">S/. </span>
                                        <span>{{product.price | number: '.2'}}</span>
                                    </div>
                                    <div *ngIf="product.promo && product.promoData.quantity == 1"
                                        class="product__price">
                                        <span style="font-size: 0.65em">S/. </span>
                                        <span>{{product.promoData.promoPrice | number: '.2'}}</span>
                                    </div>
                                    <div class="product__percent"
                                        *ngIf="product.promo && product.promoData.quantity == 1">
                                        -{{getdiscount(product)}}%
                                    </div>
                                </div>
                            </div>
                            <button *ngIf="product.realStock > product.sellMinimum" mat-mini-fab color='accent' [disabled]="stopBuy()"
                                (click)="add(product)">
                                <mat-icon>add</mat-icon>
                            </button>
                        </div>
                        <div *ngIf="product.promo && product.promoData.quantity > 1" class="w3-center product__promo">
                            OFERTA: {{product.promoData.quantity}} ({{product.unit}}) x S/.
                            {{product.promoData.promoPrice | number: '.2'}}
                        </div>
                        <div *ngIf="product.promo && product.promoData.quantity == 1"
                            style="color: #eb5757;font-size: 0.7em;">
                            Antes S/. {{product.price | number: '.2'}}
                        </div>
                    </div>
                </div>
            </mat-card>
            <div style="display: flex; width: 100%; justify-content: flex-end;" *ngIf="products$ | async ">
                <pagination-controls (pageChange)="p = $event" previousLabel="" nextLabel="" maxSize="6">
                </pagination-controls>
            </div>
        </div>
        <div class="fly-button" *ngIf="dbs.total>0">
            <div class="shopping-button background--secondary" (click)="shoppingCart()">
                <mat-icon>shopping_basket</mat-icon>
                <div class="total">S/. {{dbs.total | number: '.2'}}</div>
            </div>
        </div>
    </div>
    <div class="w3-padding" *ngIf="(dbs.view$|async)==2">
        <div class="ms-flex ms-flex--center">
            <button mat-icon-button style="margin-left: -10px; margin-top: -10px;" (click)="back()">
                <mat-icon>keyboard_backspace</mat-icon>
            </button>
            <h2 class="title2 w3-margin-left">Lista de compras ðŸ›’</h2>
        </div>
        <app-shopping-cart></app-shopping-cart>

        <button *ngIf="auth.user$ | async; else register" mat-raised-button color="accent" class="w3-block"
            (click)="finish()" style=" font-weight: bold;">
            Continuar con la compra
            <mat-icon class="w3-margin-left">arrow_forward</mat-icon>
        </button>
        <ng-template #register>
            <button mat-raised-button color="accent" class="w3-block" (click)="login()" style=" font-weight: bold;">
                Continuar con la compra
                <mat-icon class="w3-margin-left">arrow_forward</mat-icon>
            </button>
        </ng-template>
    </div>
    <div class="w3-padding" *ngIf="(dbs.view$|async)==3">
        <div class="ms-flex ms-flex--center" *ngIf="init$ | async as user">
            <button mat-icon-button style="margin-left: -10px; margin-top: -10px;" (click)="shoppingCart()">
                <mat-icon>keyboard_backspace</mat-icon>
            </button>
            <h2 *ngIf="firstSale" class="title2">Es tu primera compra ðŸ˜Š</h2>
            <h2 *ngIf="!firstSale" class="title2">Hola, {{name}} ðŸ˜Š</h2>
        </div>
        <p *ngIf="firstSale">Hola cheese lover, gracias por tu preferencia. Comencemos anotando tus datos</p>
        <p *ngIf="!firstSale">Gracias por volver a comprar nuestos productos</p>
        <app-purchase></app-purchase>
    </div>
</div>